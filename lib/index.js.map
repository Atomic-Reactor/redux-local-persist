{"version":3,"sources":["../src/index.js"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["\nimport moment from 'moment';\nimport op from 'object-path';\nimport _ from 'underscore';\n\n/**\n * -----------------------------------------------------------------------------\n * Redux Local persist\n * @author Cam Tullos <cam@tullos.ninja> (http://cam.tullos.ninja)\n * @description Redux middleware for selectively loading and saving state to localStorage.\n * -----------------------------------------------------------------------------\n */\n\nconst RLP = {\n    DELIMITER : '.',\n    NS        : 'rlp',\n};\n\n// Check if a var is an Object\nconst isObject = (o) => {\n    return o instanceof Object && o.constructor === Object;\n};\n\nconst ls = (typeof window !== 'undefined') ? window.localStorage : {\n    getItem: () => {},\n    removeItem: () => {},\n    setItem: () => {},\n};\n\n// Save state to ls\nexport const save = () => store => next => action => {\n\n    next(action);\n\n    let state    = store.getState();\n    let newState = {};\n    let expires  = {};\n\n    _.keys(state).forEach((key) => {\n\n        // Get the state value\n        let obj = state[key];\n\n        let { persist = false } = obj;\n\n        // Exit if we don't want to persist this state\n        if (persist === false) { return; }\n\n        // Save all props w/o expiration\n        if (persist === true) {\n            newState[key] = obj;\n            return;\n        }\n\n        // Save all props w/ expiration\n        if (typeof persist === 'number') {\n            let when = Number(persist);\n            if (when !== 0) { expires[key]  = moment().add(when).toISOString(); }\n            newState[key] = obj;\n            return;\n        }\n\n        // Save multiple expirations\n        if (isObject(persist)) {\n\n            _.keys(persist).forEach((k) => {\n                let when = persist[k];\n                if (Number(when) === 0 || when === true) { return; }\n\n                expires[`${key}.${k}`] = moment().add(when).toISOString();\n            });\n\n            persist = _.keys(persist);\n        }\n\n        // Save a single prop but turn it into an array anyway\n        if (typeof persist === 'string') {\n            persist = [persist];\n        }\n\n        // Save multiple props w/o expiration\n        if (_.isArray(persist)) {\n\n            persist.forEach((item) => {\n                let val = op.get(obj, item);\n                op.set(newState, `${key}.${item}`, val);\n            });\n\n            newState[key]['persist'] = obj['persist'];\n        }\n    });\n\n    ls.setItem(`${RLP.NS}-state`, JSON.stringify(newState));\n    ls.setItem(`${RLP.NS}-expire`, JSON.stringify(expires));\n};\n\n\n// Load state from ls\nexport const load = ({initialState = {}}) => {\n\n    // Get the ls state\n    let state    = ls.getItem(`${RLP.NS}-state`) || '{}';\n        state    = JSON.parse(state);\n\n    // Get the ls expires\n    let expires  = ls.getItem(`${RLP.NS}-expire`) || '{}';\n        expires  = JSON.parse(expires);\n\n    // Only validate if expires.length > 0\n    if (_.keys(expires).length > 0) {\n        let newState = Object.assign({}, state);\n\n        _.keys(expires).forEach((k) => {\n            let exp  = moment(expires[k]);\n            let diff = moment().diff(exp);\n\n            // If the value is expired -> load the initialState version\n            let val = (diff > 0) ? op.get(initialState, k) : op.get(state, k);\n            op.set(newState, k, val);\n        });\n\n        return newState;\n\n    } else {\n        return state;\n    }\n};\n\n// Clear stored state and expires\nexport const clear = (keys) => {\n\n    if (!keys) {\n        ls.removeItem(`${RLP.NS}-state`);\n        ls.removeItem(`${RLP.NS}-expire`);\n\n        return {};\n\n    } else {\n        let keys = (typeof keys === 'string') ? [keys] : keys;\n            keys = (!_.isArray(keys)) ? [keys] : keys;\n\n        let state = ls.getItem(`${RLP.NS}-state`) || '{}';\n            state = JSON.parse(state);\n\n        let expires = ls.removeItem(`${RLP.NS}-expire`) || '{}';\n            expires = JSON.parse(expires);\n\n        keys.forEach((key) => {\n            op.del(state, key);\n            delete expires[key];\n        });\n\n        ls.setItem(`${RLP.NS}-state`, JSON.stringify(state));\n        ls.setItem(`${RLP.NS}-expire`, JSON.stringify(expires));\n\n        return state;\n    }\n};\n\nexport default {\n    clear,\n    load,\n    save,\n}\n"]}